import{$ as K,a0 as H,z as v,l as C,aw as b,C as Q,a1 as X,B as Y,a9 as g,a4 as n,a3 as d,c as u,ag as Z,aj as ee,b as le,af as k,ab as ae,aa as j,U as se,a6 as w,ak as te,a2 as S,ao as oe,V as J,a7 as ue,a8 as re,d as ne,ar as V,a5 as ie,ah as de}from"./index-DT9_2KCU.js";import{r as L}from"./resume-uIzL9sNq.js";import{_ as pe,V as O,a as R}from"./_plugin-vue_export-helper-Cq28cyYG.js";import{V as ve}from"./VContainer-Dn3bCXe2.js";import{V as me}from"./VForm-DRLmqMyI.js";import{V as ce,a as fe}from"./VSwitch-DdYcgxT5.js";import{V as P}from"./VSelect-DwnW1p8o.js";import{V as z}from"./VTextarea-C6-JuJcs.js";import"./VChip-Mae0U7qf.js";import"./VList-BacElck2.js";import"./ssrBoot-CPM_QtVF.js";import"./VDivider-Dm6exH0k.js";import"./VMenu-S4u8nhxh.js";const ge={class:"headline text-primary"},ye={key:3},be={key:4},Ve={key:0,class:"d-flex justify-center"},he={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},ke={__name:"MyResume",setup(xe){const F=X(),M=K(),h=H(),x=v(!1),U=v(!1),B=v(!0),c=v(!1),s=v(!1),a=v({_id:"",photos:[],basicInfo:{name:"",age:0},education:"",licenses:[],languages:[],experience:"",preferences:{location:[],time:""},hostelType:[],expectedBenefits:[],interests:[],personality:[],motivation:"",socialLink:"",isPublic:!1}),f=v(null),p=v([]),r=v([]),m=v(null),W=C(()=>c.value?"我的履歷":"發布履歷"),T=C({get:()=>a.value.interests.join(", "),set:o=>{a.value.interests=o.split(",").map(l=>l.trim()).filter(l=>l!=="")}}),q=C({get:()=>a.value.personality.join(", "),set:o=>{a.value.personality=o.split(",").map(l=>l.trim()).filter(l=>l!=="")}}),_=["不限","台北","新北","桃園","台中","台南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","台東","澎湖","金門","連江","基隆","綠島","小琉球","蘭嶼","馬祖"].map(o=>({title:o,value:o})),$=o=>{try{return new URL(o),!0}catch{return!1}},D=o=>{var t;for(const i of r.value)i.startsWith("blob:")&&URL.revokeObjectURL(i);const l=((t=a.value.photos)==null?void 0:t.filter(i=>!i.startsWith("blob:")))||[],e=Array.isArray(o)?o:o?[o]:[];r.value=[...l,...e.map(i=>URL.createObjectURL(i))],m.value=r.value.length>0?r.value[0]:null},E=C(()=>{var e,t;const o=[],l=(((e=a.value.photos)==null?void 0:e.length)||0)+(((t=p.value)==null?void 0:t.length)||0);return c.value||o.push(i=>i&&i.length>0||"請上傳個人照片"),o.push(i=>l<=5||"上傳照片總數不能超過 5 張"),o}),N=C(()=>{var e,t,i;if(console.log("Checking hasChanges:",{photoFiles:p.value.length,resumePhotos:a.value.photos,originalPhotos:(e=f.value)==null?void 0:e.photos}),p.value.length>0||!f.value)return!0;const o={...b(a.value)},l={...b(f.value)};return o.photos=((t=o.photos)==null?void 0:t.filter(y=>!y.startsWith("blob:")))||[],l.photos=((i=l.photos)==null?void 0:i.filter(y=>!y.startsWith("blob:")))||[],JSON.stringify(o)!==JSON.stringify(l)}),A=()=>{Object.assign(a.value,structuredClone(b(f.value))),p.value=[],r.value=a.value.photos||[],m.value=r.value.length>0?r.value[0]:null,s.value=!1,h({text:"已取消修改",snackbarProps:{color:"info"}})};Q(async()=>{var o,l;if(!M.isLoggedIn){F.push("/login");return}try{const{data:e}=await L.getMyResume();e.result&&typeof e.result=="object"?(Object.assign(a.value,e.result),f.value=structuredClone(b(e.result)),c.value=!0,s.value=!1,r.value=a.value.photos||[],m.value=r.value.length>0?r.value[0]:null):(c.value=!1,s.value=!0)}catch(e){console.error("Get resume error:",e),e.response&&e.response.status===404?(c.value=!1,s.value=!0):h({text:((l=(o=e.response)==null?void 0:o.data)==null?void 0:l.message)||"載入履歷失敗",snackbarProps:{color:"red"}})}finally{B.value=!1}}),Y(s,o=>{o&&f.value&&(Object.assign(a.value,structuredClone(b(f.value))),p.value=[],r.value=a.value.photos||[],m.value=r.value.length>0?r.value[0]:null)},{immediate:!0});const G=async()=>{var o,l,e;U.value=!0,console.log("Saving resume:",{formValid:x.value,hasChanges:N.value,resume:b(a.value),photoFiles:p.value});try{if(!x.value){h({text:"請檢查所有必填欄位",snackbarProps:{color:"red"}});return}if(!N.value){h({text:"資料沒有變動",snackbarProps:{color:"info"}}),s.value=!1;return}const t=new FormData;t.append("basicInfo",JSON.stringify(a.value.basicInfo)),t.append("education",a.value.education),t.append("licenses",JSON.stringify(a.value.licenses)),t.append("languages",JSON.stringify(a.value.languages)),t.append("experience",a.value.experience),t.append("preferences",JSON.stringify(a.value.preferences)),t.append("hostelType",JSON.stringify(a.value.hostelType)),t.append("expectedBenefits",JSON.stringify(a.value.expectedBenefits)),t.append("interests",JSON.stringify(a.value.interests)),t.append("personality",JSON.stringify(a.value.personality)),t.append("motivation",a.value.motivation),t.append("socialLink",a.value.socialLink),t.append("isPublic",a.value.isPublic);const i=((o=a.value.photos)==null?void 0:o.filter(I=>!I.startsWith("blob:")))||[];if(c.value&&i.length>0&&t.append("photosToKeep",JSON.stringify(i)),p.value.length>0)for(const I of p.value)t.append("images",I);const{data:y}=await(c.value?L.updateResume(a.value._id,t):L.createResume(t));console.log("Save response:",y),h({text:"保存成功",snackbarProps:{color:"green"}}),Object.assign(a.value,y.result),f.value=structuredClone(b(a.value)),s.value=!1,p.value=[],r.value=y.result.photos||[],m.value=r.value.length>0?r.value[0]:null}catch(t){console.error("Save resume error:",t),h({text:((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.message)||"保存失敗",snackbarProps:{color:"red"}})}finally{U.value=!1}};return(o,l)=>(d(),g(ve,{fluid:""},{default:n(()=>[u(O,{justify:"center"},{default:n(()=>[u(R,{cols:"12",md:"8"},{default:n(()=>[u(Z,{style:{border:"1px solid #3B7D96 !important","box-shadow":"10px 10px 0px rgba(60,125,150,0.5)",padding:"1.5rem"}},{default:n(()=>[u(ee,{class:"d-flex align-center justify-space-between w-100"},{default:n(()=>[le("span",ge,ae(W.value),1),c.value&&!s.value?(d(),g(j,{key:0,color:"primary",icon:"",size:"small",onClick:l[0]||(l[0]=e=>s.value=!0)},{default:n(()=>[u(se,null,{default:n(()=>l[19]||(l[19]=[w("mdi-pencil",-1)])),_:1,__:[19]})]),_:1})):k("",!0)]),_:1}),u(te,null,{default:n(()=>[B.value?(d(),S("div",he,[u(de,{color:"primary",indeterminate:""})])):(d(),g(me,{key:0,modelValue:x.value,"onUpdate:modelValue":l[18]||(l[18]=e=>x.value=e),onSubmit:oe(G,["prevent"])},{default:n(()=>[m.value?(d(),g(O,{key:0,class:"mb-4",justify:"center"},{default:n(()=>[u(R,{cols:"12",md:"3"},{default:n(()=>[u(J,{"aspect-ratio":"1",class:"rounded-lg elevation-4",cover:"",src:m.value},null,8,["src"])]),_:1})]),_:1})):k("",!0),r.value.length>0?(d(),g(O,{key:1,class:"mb-2",justify:"center"},{default:n(()=>[(d(!0),S(ue,null,re(r.value,(e,t)=>(d(),g(R,{key:t,class:"d-flex justify-center",cols:"auto"},{default:n(()=>[u(J,{"aspect-ratio":"1",class:ne(["rounded-lg",{"photo-thumbnail":!0,active:e===m.value}]),src:e,onClick:i=>m.value=e},null,8,["class","src","onClick"])]),_:2},1024))),128))]),_:1})):k("",!0),s.value?(d(),g(ce,{key:2,modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=e=>p.value=e),label:"上傳個人照片 (一次多選上傳，最多五張)",multiple:"",rules:E.value,variant:"outlined",onChange:D},null,8,["modelValue","rules"])):k("",!0),a.value.basicInfo?(d(),S("div",ye,[u(V,{modelValue:a.value.basicInfo.name,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.basicInfo.name=e),label:"姓名",readonly:!s.value,required:"",rules:[e=>!!e||"姓名是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),u(V,{modelValue:a.value.basicInfo.age,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.basicInfo.age=e),modelModifiers:{number:!0},label:"年齡",readonly:!s.value,required:"",rules:[e=>!!e&&e>=18||"年齡必須大於或等於 18"],type:"number",variant:"outlined"},null,8,["modelValue","readonly","rules"])])):k("",!0),u(V,{modelValue:a.value.education,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.education=e),label:"學歷",readonly:!s.value,required:"",rules:[e=>!!e||"學歷是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),u(P,{modelValue:a.value.licenses,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.licenses=e),"chip-props":{size:s.value?"large":"small"},chips:"","closable-chips":s.value,items:["無","機車","汽車"],label:"駕照 (可多選)",multiple:"",readonly:!s.value,required:"",rules:[e=>!!e&&e.length>0||"請選擇至少一個駕照選項"],variant:"outlined"},null,8,["modelValue","chip-props","closable-chips","readonly","rules"]),u(P,{modelValue:a.value.languages,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.languages=e),"chip-props":{size:s.value?"large":"small"},chips:"","closable-chips":s.value,items:["中文","英文","台語","日文","其他"],label:"語言",multiple:"",readonly:!s.value,required:"",rules:[e=>!!e&&e.length>0||"至少選擇一種語言"],variant:"outlined"},null,8,["modelValue","chip-props","closable-chips","readonly","rules"]),u(z,{modelValue:a.value.experience,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.experience=e),label:"工作經驗",readonly:!s.value,required:"",rules:[e=>!!e||"工作經驗是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),a.value.preferences?(d(),S("div",be,[u(P,{modelValue:a.value.preferences.location,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.preferences.location=e),"chip-props":{size:s.value?"large":"small"},chips:"","closable-chips":s.value,"item-title":"title","item-value":"value",items:ie(_),label:"希望地點 (可多選)",multiple:"",readonly:!s.value,required:"",rules:[e=>!!e&&e.length>0||"至少選擇一個希望地點"],variant:"outlined"},null,8,["modelValue","chip-props","closable-chips","items","readonly","rules"]),u(V,{modelValue:a.value.preferences.time,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.preferences.time=e),label:"希望時間",readonly:!s.value,required:"",rules:[e=>!!e||"希望時間是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"])])):k("",!0),u(P,{modelValue:a.value.hostelType,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.hostelType=e),"chip-props":{size:s.value?"large":"small"},chips:"","closable-chips":s.value,items:["旅宿","餐飲","潛水/衝浪"],label:"換宿類型",multiple:"",readonly:!s.value,required:"",rules:[e=>!!e&&e.length>0||"至少選擇一種換宿類型"],variant:"outlined"},null,8,["modelValue","chip-props","closable-chips","readonly","rules"]),u(P,{modelValue:a.value.expectedBenefits,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.expectedBenefits=e),"chip-props":{size:s.value?"large":"small"},chips:"","closable-chips":s.value,items:["機車","住宿","伙食","零用金","交通票券"],label:"期望待遇",multiple:"",readonly:!s.value,required:"",rules:[e=>!!e&&e.length>0||"至少選擇一種期望待遇"],variant:"outlined"},null,8,["modelValue","chip-props","closable-chips","readonly","rules"]),u(V,{modelValue:T.value,"onUpdate:modelValue":l[12]||(l[12]=e=>T.value=e),label:"興趣 (請用逗點分隔)",readonly:!s.value,variant:"outlined"},null,8,["modelValue","readonly"]),u(V,{modelValue:q.value,"onUpdate:modelValue":l[13]||(l[13]=e=>q.value=e),label:"個性 (請用逗點分隔)",readonly:!s.value,variant:"outlined"},null,8,["modelValue","readonly"]),u(z,{modelValue:a.value.motivation,"onUpdate:modelValue":l[14]||(l[14]=e=>a.value.motivation=e),label:"換宿動機",readonly:!s.value,required:"",rules:[e=>!!e||"換宿動機是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),u(V,{modelValue:a.value.socialLink,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.socialLink=e),label:"社群網址",placeholder:"例如: https://instagram.com/",readonly:!s.value,rules:[e=>!e||$(e)||"請輸入有效的網址"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),u(fe,{modelValue:a.value.isPublic,"onUpdate:modelValue":l[16]||(l[16]=e=>a.value.isPublic=e),class:"mt-2",color:"primary",disabled:!s.value,label:"是否公開履歷"},null,8,["modelValue","disabled"]),u(O,{class:"mt-4"},{default:n(()=>[u(R,{cols:"6",offset:"3"},{default:n(()=>[s.value?(d(),S("div",Ve,[u(j,{block:"",class:"ma-2",color:"primary",disabled:!x.value||U.value||!N.value,loading:U.value,type:"submit"},{default:n(()=>l[20]||(l[20]=[w(" 保存履歷 ",-1)])),_:1,__:[20]},8,["disabled","loading"]),u(j,{block:"",class:"ma-2",color:"secondary",disabled:U.value,onClick:A},{default:n(()=>l[21]||(l[21]=[w(" 取消編輯 ",-1)])),_:1,__:[21]},8,["disabled"])])):(d(),g(j,{key:1,block:"",class:"ma-2",color:"secondary",onClick:l[17]||(l[17]=e=>s.value=!0)},{default:n(()=>l[22]||(l[22]=[w(" 修改履歷 ",-1)])),_:1,__:[22]}))]),_:1})]),_:1})]),_:1},8,["modelValue"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},qe=pe(ke,[["__scopeId","data-v-0cae4031"]]);export{qe as default};
