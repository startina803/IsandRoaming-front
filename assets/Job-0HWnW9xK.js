import{a0 as M,z as y,l as R,B as I,C as E,a9 as d,a4 as n,a3 as s,c as o,ag as z,aj as K,b as P,af as k,ab as L,aa as w,U as _,a6 as V,ak as W,ao as O,a2 as F,V as N,a7 as G,a8 as H,d as Q,ar as g}from"./index-DT9_2KCU.js";import{j as S}from"./job-B_bayAxe.js";import{_ as X,V as x,a as U}from"./_plugin-vue_export-helper-Cq28cyYG.js";import{V as Y}from"./VContainer-Dn3bCXe2.js";import{V as Z}from"./VForm-DRLmqMyI.js";import{V as ee,a as le}from"./VSwitch-DdYcgxT5.js";import{V as ae}from"./VSelect-DwnW1p8o.js";import{V as J}from"./VTextarea-C6-JuJcs.js";import"./VChip-Mae0U7qf.js";import"./VList-BacElck2.js";import"./ssrBoot-CPM_QtVF.js";import"./VDivider-Dm6exH0k.js";import"./VMenu-S4u8nhxh.js";const te={class:"headline text-primary"},oe={class:"mt-2 text-center text-subtitle-2 text-medium-emphasis"},ne={key:3,class:"mb-4 text-center"},re={class:"text-subtitle-1 text-medium-emphasis"},C=5,ue={__name:"Job",setup(se){const b=M(),h=y(!1),c=y(!1),i=y(!1),r=y(!1),a=y({_id:"",title:"",location:"",detailedLocation:"",workPeriod:"",requiredPeopleCount:"",photos:[],workContent:"",helperBenefits:"",notes:"",socialLink:"",status:"closed"}),u=y([]),B=R(()=>u.value.map(t=>({key:t.key,url:t.url}))),v=y(null);I(B,t=>{(!v.value||!t.some(l=>l.url===v.value))&&(v.value=t.length>0?t[0].url:null)});const q=["台北","新北","桃園","台中","台南","高雄","新竹","苗栗","彰化","南投","雲林","嘉義","屏東","宜蘭","花蓮","台東","澎湖","金門","連江","基隆","新竹","嘉義","綠島","小琉球","蘭嶼","馬祖"],A=t=>{try{return new URL(t),!0}catch{return!1}},T=t=>{const l=t.target.files;if(!l||l.length===0)return;const e=Array.from(l),m=C-u.value.length;e.length>m&&b({text:`最多只能再上傳 ${m} 張照片`,snackbarProps:{color:"red"}});for(const p of e.slice(0,m))u.value.push({key:Date.now()+Math.random(),url:URL.createObjectURL(p),file:p});t.target.value=""},$=t=>{const l=u.value[t];l&&l.url&&l.url.startsWith("blob:")&&URL.revokeObjectURL(l.url),u.value.splice(t,1)},D=async()=>{var t,l;c.value=!0;try{if(!h.value||u.value.length>C){b({text:"請檢查所有欄位及照片數量",snackbarProps:{color:"red"}});return}const e=new FormData;e.append("title",a.value.title),e.append("location",a.value.location),e.append("detailedLocation",a.value.detailedLocation),e.append("workPeriod",a.value.workPeriod),e.append("requiredPeopleCount",a.value.requiredPeopleCount),e.append("notes",a.value.notes),e.append("socialLink",a.value.socialLink),e.append("workContent",a.value.workContent),e.append("helperBenefits",a.value.helperBenefits);const m=[],p=[];for(const f of u.value)f.file?p.push(f.file):f.url&&m.push(f.url);if(i.value)e.append("status",a.value.status),e.append("photosToKeep",JSON.stringify(m));else{if(p.length===0){b({text:"新增工作必須上傳至少一張照片",snackbarProps:{color:"red"}}),c.value=!1;return}e.append("status","open")}if(p.length>0)for(const f of p)e.append("images",f);const{data:j}=await(i.value?S.updateJob(a.value._id,e):S.createJob(e));console.log("--- SAVE JOB: Backend response ---",JSON.stringify(j,null,2)),b({text:`工作${i.value?"修改":"新增"}成功`,snackbarProps:{color:"green"}}),j.result&&(Object.assign(a.value,j.result),i.value=!0,u.value=(a.value.photos||[]).map(f=>({key:Date.now()+Math.random(),url:f,file:null})),v.value=u.value.length>0?u.value[0].url:null),r.value=!1}catch(e){console.error("Save job error:",e),b({text:((l=(t=e.response)==null?void 0:t.data)==null?void 0:l.message)||`工作${i.value?"修改":"新增"}失敗`,snackbarProps:{color:"red"}})}finally{c.value=!1}};return E(async()=>{c.value=!0;try{const{data:t}=await S.getMyJobs();console.log("--- ON MOUNTED: Backend data ---",JSON.stringify(t,null,2)),t.result&&t.result.length>0?(i.value=!0,Object.assign(a.value,t.result[0]),a.value.workContent=Array.isArray(a.value.workContent)?a.value.workContent.join(`
`):a.value.workContent||"",a.value.helperBenefits=Array.isArray(a.value.helperBenefits)?a.value.helperBenefits.join(`
`):a.value.helperBenefits||"",a.value.notes=Array.isArray(a.value.notes)?a.value.notes.join(`
`):a.value.notes||"",u.value=(a.value.photos||[]).map(l=>({key:Date.now()+Math.random(),url:l,file:null})),u.value.length>0&&(v.value=u.value[0].url),r.value=!1):(i.value=!1,r.value=!0)}catch(t){console.error("找不到現有工作或載入失敗:",t)}finally{c.value=!1}}),(t,l)=>(s(),d(Y,{fluid:""},{default:n(()=>[o(x,{justify:"center"},{default:n(()=>[o(U,{cols:"12",md:"8"},{default:n(()=>[o(z,{style:{border:"1px solid #3B7D96 !important","box-shadow":"10px 10px 0px rgba(60,125,150,0.5)",padding:"1.5rem"}},{default:n(()=>[o(K,{class:"d-flex align-center justify-space-between w-100"},{default:n(()=>[P("span",te,L(i.value?"換宿工作":"發布換宿工作"),1),!r.value&&i.value?(s(),d(w,{key:0,color:"primary",icon:"",size:"small",onClick:l[0]||(l[0]=e=>r.value=!0)},{default:n(()=>[o(_,null,{default:n(()=>l[13]||(l[13]=[V("mdi-pencil",-1)])),_:1,__:[13]})]),_:1})):k("",!0)]),_:1}),o(W,null,{default:n(()=>[o(Z,{modelValue:h.value,"onUpdate:modelValue":l[12]||(l[12]=e=>h.value=e),onSubmit:O(D,["prevent"])},{default:n(()=>[v.value?(s(),d(x,{key:0,class:"mb-4",justify:"center"},{default:n(()=>[o(U,{class:"d-flex justify-center align-center",cols:"12",md:"4"},{default:n(()=>[o(N,{"aspect-ratio":"1",class:"rounded-lg elevation-4",contain:"",src:v.value},null,8,["src"])]),_:1})]),_:1})):k("",!0),B.value.length>0?(s(),d(x,{key:1,class:"mb-2",justify:"center"},{default:n(()=>[(s(!0),F(G,null,H(B.value,(e,m)=>(s(),d(U,{key:`photo-${e.key}`,class:"d-flex justify-center photo-thumbnail-container",cols:"auto"},{default:n(()=>[o(N,{"aspect-ratio":"1",class:Q(["rounded-lg photo-thumbnail",{active:e.url===v.value}]),src:e.url,onClick:p=>v.value=e.url},null,8,["class","src","onClick"]),r.value?(s(),d(w,{key:0,class:"delete-btn",color:"red",icon:"",size:"small",variant:"plain",onClick:O(p=>$(m),["stop"])},{default:n(()=>[o(_,null,{default:n(()=>l[14]||(l[14]=[V("mdi-close-circle",-1)])),_:1,__:[14]})]),_:2},1032,["onClick"])):k("",!0)]),_:2},1024))),128))]),_:1})):k("",!0),r.value?(s(),d(ee,{key:2,ref:"fileInputRef",disabled:u.value.length>=C,label:"上傳旅宿照片",multiple:!0,variant:"outlined",onChange:T},{message:n(()=>[P("div",oe," 目前已選 "+L(u.value.length)+" 張，最多可上傳 "+L(C)+" 張。 ",1)]),_:1},8,["disabled"])):(s(),F("div",ne,[P("p",re,[l[15]||(l[15]=V("如需修改照片，請點擊標題旁的",-1)),o(_,{color:"primary",icon:"mdi-pencil"}),l[16]||(l[16]=V("按鈕進入編輯模式。",-1))])])),o(g,{modelValue:a.value.title,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.title=e),label:"旅宿名稱",readonly:!r.value,required:"",rules:[e=>!!e||"旅宿名稱是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),o(ae,{modelValue:a.value.location,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.location=e),items:q,label:"旅宿地區",readonly:!r.value,required:"",rules:[e=>!!e||"旅宿地點是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),o(g,{modelValue:a.value.detailedLocation,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.detailedLocation=e),label:"旅宿地點",placeholder:"例如：新北市淡水區中正路一段",readonly:!r.value,variant:"outlined"},null,8,["modelValue","readonly"]),o(g,{modelValue:a.value.workPeriod,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.workPeriod=e),label:"換宿時間",placeholder:"例如：2025年9月/10月/11月",readonly:!r.value,variant:"outlined"},null,8,["modelValue","readonly"]),o(g,{modelValue:a.value.requiredPeopleCount,"onUpdate:modelValue":l[5]||(l[5]=e=>a.value.requiredPeopleCount=e),label:"需求人數",placeholder:"例如：2或 '3-4",readonly:!r.value,required:"",rules:[e=>!!e||"需求人數是必填的"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),o(J,{modelValue:a.value.workContent,"onUpdate:modelValue":l[6]||(l[6]=e=>a.value.workContent=e),label:"工作內容",placeholder:`例如：（列點呈現）
◆工作日工時4小時，每天視訂房情況彈性調整工作內容
（每週平日休一天，未滿一週無休假）
◆整理清掃公共區域
◆餵五隻店貓（早晚清貓砂）
◆頂樓植物澆水
◆房務（鋪床）工作
◆洗烘床單
◆丟垃圾`,readonly:!r.value,variant:"outlined"},null,8,["modelValue","readonly"]),o(J,{modelValue:a.value.helperBenefits,"onUpdate:modelValue":l[7]||(l[7]=e=>a.value.helperBenefits=e),label:"小幫手福利 ",placeholder:`例如：（列點呈現）
◆住宿環境，四人上下舖背包房，有冷暖氣、洗衣機、烘衣機、衛浴共用
◆提供機車（兩人使用一台，油錢自付，限小幫手使用）
◆無供三餐但隨時會有好料分享（有廚房可自行開伙）
◆無特別之事時可自由安排時間做自己的事
◆可提供衝浪練習板使用（衝浪教學可衝浪街詢問）
◆滿ㄧ個月者另提供零用金和龜山島三合一/飛行傘擇一（需視當月天氣狀況）`,readonly:!r.value,variant:"outlined"},null,8,["modelValue","readonly"]),o(J,{modelValue:a.value.notes,"onUpdate:modelValue":l[8]||(l[8]=e=>a.value.notes=e),label:"備註",placeholder:`例如：（列點呈現）
◆需年滿二十歲，且家長同意。(未滿需有家長同意書）
◆需具備機車駕照。（ㄧ定要會騎機車）
◆民宿內有五隻店貓，不喜毛孩者請勿試。（有常備不含類固醇的過敏藥）
◆海邊難免有蚊蟲叮咬，不喜者勿試。
◆因過往經驗皆不佳，目前不接受朋友共同換宿
◆換宿適應期為ㄧ週（若不如預期所望，皆可提前告知結束配合）`,readonly:!r.value,variant:"outlined"},null,8,["modelValue","readonly"]),o(g,{modelValue:a.value.socialLink,"onUpdate:modelValue":l[9]||(l[9]=e=>a.value.socialLink=e),label:"社群或是官網",placeholder:"例如: https://instagram.com/",readonly:!r.value,rules:[e=>!e||A(e)||"請輸入有效的網址"],variant:"outlined"},null,8,["modelValue","readonly","rules"]),i.value?(s(),d(le,{key:4,modelValue:a.value.status,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.status=e),color:"primary",disabled:!r.value,"false-value":"closed",inset:"",label:"發佈此工作","true-value":"open"},null,8,["modelValue","disabled"])):k("",!0),o(x,{class:"mt-4"},{default:n(()=>[o(U,{cols:"6",offset:"3"},{default:n(()=>[r.value?(s(),d(w,{key:0,block:"",class:"ma-2",color:"primary",disabled:!h.value||c.value||u.value.length>C,loading:c.value,type:"submit"},{default:n(()=>l[17]||(l[17]=[V(" 保存修改 ",-1)])),_:1,__:[17]},8,["disabled","loading"])):(s(),d(w,{key:1,block:"",class:"ma-2",color:"primary",onClick:l[11]||(l[11]=e=>r.value=!0)},{default:n(()=>l[18]||(l[18]=[V(" 編輯 ",-1)])),_:1,__:[18]}))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},he=X(ue,[["__scopeId","data-v-0d5ca8c5"]]);export{he as default};
