import{av as _,a1 as z,a0 as S,z as g,$ as U,C as B,a2 as n,a6 as i,c as o,a3 as s,d as r,ac as M,ah as P,a8 as c,ab as f,a4 as R,a9 as I,b as L,Z as k,aa as D,ao as F}from"./index-Byp8e-x8.js";import{_ as T,V as j,a as E}from"./_plugin-vue_export-helper-CWTpz6OG.js";import{V as Z}from"./VAlert-Dzl-FIT5.js";import{V as q}from"./VTooltip-BMYMCMsk.js";import{V as G}from"./VContainer-CJAcr6hH.js";const h={getMyNotifications(){return _.apiAuth.get("/notifications")},markAsRead(d){return _.apiAuth.patch(`/notifications/${d}/read`)},deleteNotification(d){return _.apiAuth.delete(`/notifications/${d}`)},getUnreadCount(){return _.apiAuth.get("/notifications/unread-count")}},H={class:"notifications-page"},J={key:0,class:"text-center pa-12"},K={key:2},O=["onClick"],Q={class:"notification-icon"},W={class:"notification-content"},X={class:"notification-text"},Y={class:"notification-time"},tt={class:"notification-action"},et={key:3,class:"empty-state"},at={__name:"Notifications",setup(d){const V=z(),m=S(),l=g([]),C=g(!0),v=g(null),y=U(),N=async()=>{var e,t;try{const{data:a}=await h.getMyNotifications();l.value=a.result.list,y.setUnreadCount(a.result.unreadCount)}catch(a){console.log(a),v.value="載入通知失敗",m({text:((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"載入通知失敗",snackbarProps:{color:"error"}})}finally{C.value=!1}},x=e=>e==="invitation"?"mdi-email-fast-outline":e==="application_status"?"mdi-account-arrow-left-outline":"mdi-bell-outline",w=e=>{var t;if((t=e.related)!=null&&t.id){if(e.type==="invitation")return`/invitations/${e.related.id._id}`;if(e.type==="application_status"&&e.related.model==="Application")return`/applications/${e.related.id._id}`}return null},A=async e=>{if(!e.read)try{await h.markAsRead(e._id),e.read=!0,y.decrementUnreadCount()}catch(a){console.error("Failed to mark notification as read",a)}const t=w(e);t&&t!=="#"&&V.push(t)},b=async(e,t)=>{var u,p;const a=!l.value[t].read;try{await h.deleteNotification(e),l.value.splice(t,1),a&&y.decrementUnreadCount(),m({text:"通知已刪除",snackbarProps:{color:"success"}})}catch($){m({text:((p=(u=$.response)==null?void 0:u.data)==null?void 0:p.message)||"刪除失敗",snackbarProps:{color:"error"}})}};return B(N),(e,t)=>(i(),n("div",H,[o(G,null,{default:s(()=>[o(j,{justify:"center"},{default:s(()=>[o(E,{cols:"12",md:"8"},{default:s(()=>[t[5]||(t[5]=r("h1",{class:"page-title text-primary"},"通知中心",-1)),C.value?(i(),n("div",J,[o(P,{color:"primary",indeterminate:"",size:"64"}),t[0]||(t[0]=r("p",{class:"mt-4"},"正在載入通知...",-1))])):v.value?(i(),M(Z,{key:1,prominent:"",type:"error"},{default:s(()=>[c(f(v.value),1)]),_:1})):l.value.length>0?(i(),n("div",K,[(i(!0),n(R,null,I(l.value,(a,u)=>(i(),n("div",{key:a._id,class:L(["notification-card",{unread:!a.read}]),onClick:p=>A(a)},[r("div",Q,[o(k,{color:a.read?"grey-darken-1":"primary",size:"28"},{default:s(()=>[c(f(x(a.type)),1)]),_:2},1032,["color"])]),r("div",W,[r("p",X,f(a.content),1),r("span",Y,f(new Date(a.createdAt).toLocaleString()),1)]),r("div",tt,[o(D,{icon:"",size:"small",variant:"text",onClick:F(p=>b(a._id,u),["stop","prevent"])},{default:s(()=>[o(k,{color:"grey"},{default:s(()=>t[1]||(t[1]=[c("mdi-delete-outline",-1)])),_:1,__:[1]}),o(q,{activator:"parent",location:"top"},{default:s(()=>t[2]||(t[2]=[c("刪除通知",-1)])),_:1,__:[2]})]),_:2},1032,["onClick"])])],10,O))),128))])):(i(),n("div",et,[o(k,{color:"grey-lighten-1",size:"64"},{default:s(()=>t[3]||(t[3]=[c("mdi-bell-off-outline",-1)])),_:1,__:[3]}),t[4]||(t[4]=r("p",{class:"mt-4 text-h6 text-grey"},"目前沒有任何通知",-1))]))]),_:1,__:[5]})]),_:1})]),_:1})]))}},lt=T(at,[["__scopeId","data-v-4c8104e2"]]);export{lt as default};
