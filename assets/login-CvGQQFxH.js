import{z as t,$ as C,a0 as L,B as R,a2 as S,c as o,a4 as s,au as T,ae as U,a1 as I,a3 as B,ag as D,V as N,b as P,aj as E,a6 as d,ak as F,ao as j,ar as k,aa as f,am as q,an as A,ap as O}from"./index-C55sMSK3.js";import $ from"./index-CYbxTTbG.js";import{_ as z,V as J,a as _}from"./_plugin-vue_export-helper-DV_06Gul.js";import{V as K}from"./VForm-CYRNDO6J.js";import"./VContainer-CUh0MeAW.js";import"./VDivider-6-PoTZaw.js";const M=""+new URL("login-1-Cxro3_OK.jpg",import.meta.url).href,G={class:"pa-md-8 pa-6 d-flex flex-column h-100"},H={__name:"login",setup(Q){const r=t(!1),i=t(!1),m=t(!1),c=t(""),g=t(""),V=t(M),b=U(),p=I(),n=C(),v=L();R(()=>b.path,l=>{console.log("Route changed to:",l),r.value=l==="/login"},{immediate:!0});const w=async()=>{var l,a;console.log("Submit clicked"),m.value=!0;try{const e=await O.login({account:c.value,password:g.value});console.log("Raw response:",e);const u=e.data.user||e.data;if(!u.token)throw new Error("Token is missing in response: "+JSON.stringify(u));n.login(u),console.log("Login success, Processed Data:",u,"isLoggedIn:",n.isLoggedIn,"Nickname:",n.nickname,"Token:",n.token),v({text:"登入成功！",snackbarProps:{color:"green"}}),p.push("/"),x()}catch(e){console.error("Login error:",e.response?e.response.data:e.message),v({text:((a=(l=e.response)==null?void 0:l.data)==null?void 0:a.message)||e.message||"登入失敗，請稍後再試！",snackbarProps:{color:"red"}})}finally{m.value=!1}},y=()=>{p.push("/register")},x=()=>{r.value=!1,p.push("/")};return(l,a)=>(B(),S("div",null,[o($),o(T,{modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value=e),"max-width":"800",persistent:""},{default:s(()=>[o(D,{class:"pa-0"},{default:s(()=>[o(J,{"no-gutters":""},{default:s(()=>[o(_,{class:"d-none d-md-block",md:"6"},{default:s(()=>[o(N,{class:"rounded-l-lg",cover:"",height:"100%",src:V.value,onError:a[0]||(a[0]=e=>V.value="/fallback-image.png")},null,8,["src"])]),_:1}),o(_,{class:"d-flex flex-column",cols:"12",md:"6"},{default:s(()=>[P("div",G,[o(E,{class:"headline text-center pa-0 mb-6"},{default:s(()=>a[5]||(a[5]=[d("會員登入",-1)])),_:1,__:[5]}),o(F,{class:"pa-0 flex-grow-1"},{default:s(()=>[o(K,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value=e),onSubmit:j(w,["prevent"])},{default:s(()=>[o(k,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),label:"帳號",required:"",rules:[e=>!!e||"帳號是必填的"],variant:"outlined"},null,8,["modelValue","rules"]),o(k,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),label:"密碼",required:"",rules:[e=>!!e||"密碼是必填的"],type:"password",variant:"outlined"},null,8,["modelValue","rules"]),o(f,{block:"",class:"mt-2",color:"primary",disabled:!i.value,loading:m.value,type:"submit"},{default:s(()=>a[6]||(a[6]=[d(" 登入 ",-1)])),_:1,__:[6]},8,["disabled","loading"]),o(f,{class:"mt-2",color:"primary",text:"",onClick:y},{default:s(()=>a[7]||(a[7]=[d(" 還沒有建立帳號嗎？註冊 ",-1)])),_:1,__:[7]})]),_:1},8,["modelValue"])]),_:1}),o(q,{class:"pa-0 mt-4"},{default:s(()=>[o(A),o(f,{color:"secondary",onClick:x},{default:s(()=>a[8]||(a[8]=[d("關閉",-1)])),_:1,__:[8]})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ae=z(H,[["__scopeId","data-v-d7c95916"]]);export{ae as default};
