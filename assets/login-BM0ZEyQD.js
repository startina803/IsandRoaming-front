import{z as t,ae as L,a1 as R,$ as T,a0 as U,B as S,ac as D,a6 as I,a3 as l,c as o,au as j,ag as B,aj as N,a8 as i,ak as F,V as P,ao as q,ar as y,aa as V,am as A,ap as E}from"./index-Byp8e-x8.js";import{_ as O,V as b,a as v}from"./_plugin-vue_export-helper-CWTpz6OG.js";import{V as $}from"./VForm-DZe3-EFa.js";import{V as z}from"./VContainer-CJAcr6hH.js";const J=""+new URL("login-1-Cxro3_OK.jpg",import.meta.url).href,K={__name:"login",setup(M){const r=t(!1),d=t(!1),g=t(!1),m=t(""),c=t(""),_=t(J),x=L(),p=R(),n=T(),k=U();S(()=>x.path,s=>{console.log("Route changed to:",s),r.value=s==="/login"},{immediate:!0});const w=async()=>{var s,a;console.log("Submit clicked"),g.value=!0;try{const e=await E.login({account:m.value,password:c.value});console.log("Raw response:",e);const u=e.data.user||e.data;if(!u.token)throw new Error("Token is missing in response: "+JSON.stringify(u));n.login(u),console.log("Login success, Processed Data:",u,"isLoggedIn:",n.isLoggedIn,"Nickname:",n.nickname,"Token:",n.token),k({text:"登入成功！",snackbarProps:{color:"green"}}),p.push("/"),f()}catch(e){console.error("Login error:",e.response?e.response.data:e.message),k({text:((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||e.message||"登入失敗，請稍後再試！",snackbarProps:{color:"red"}})}finally{g.value=!1}},C=()=>{f(),p.push("/register")},f=()=>{r.value=!1,p.push("/")};return(s,a)=>(I(),D(z,{fluid:""},{default:l(()=>[o(b,{align:"center",justify:"center",style:{"min-height":"80vh"}},{default:l(()=>[o(v,{cols:"12"},{default:l(()=>[o(j,{modelValue:r.value,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value=e),"max-width":"800"},{default:l(()=>[o(B,null,{default:l(()=>[o(N,{class:"headline",style:{display:"flex","justify-content":"center"}},{default:l(()=>a[5]||(a[5]=[i("會員登入",-1)])),_:1,__:[5]}),o(F,null,{default:l(()=>[o(b,null,{default:l(()=>[o(v,{cols:"6"},{default:l(()=>[o(P,{"aspect-ratio":"1",cover:"",src:_.value,onError:a[0]||(a[0]=e=>_.value="/fallback-image.png")},null,8,["src"])]),_:1}),o(v,{cols:"6"},{default:l(()=>[o($,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),onSubmit:q(w,["prevent"])},{default:l(()=>[o(y,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"帳號",required:"",rules:[e=>!!e||"帳號是必填的"],variant:"outlined"},null,8,["modelValue","rules"]),o(y,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),label:"密碼",required:"",rules:[e=>!!e||"密碼是必填的"],type:"password",variant:"outlined"},null,8,["modelValue","rules"]),o(V,{block:"",class:"mt-2",color:"primary",disabled:!d.value,loading:g.value,type:"submit"},{default:l(()=>a[6]||(a[6]=[i(" 登入 ",-1)])),_:1,__:[6]},8,["disabled","loading"]),o(V,{class:"mt-2",color:"primary",text:"",onClick:C},{default:l(()=>a[7]||(a[7]=[i(" 還沒有建立帳號嗎？註冊 ",-1)])),_:1,__:[7]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(A,null,{default:l(()=>[o(V,{color:"secondary",onClick:f},{default:l(()=>a[8]||(a[8]=[i("關閉",-1)])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},X=O(K,[["__scopeId","data-v-625e5545"]]);export{X as default};
